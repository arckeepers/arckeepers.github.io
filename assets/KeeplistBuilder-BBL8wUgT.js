import{r as n,s as I,a as S,j as a,P as L,C as H,b as P,T as q,S as z,D as G}from"./index-9do3R5v5.js";const V=new Map(S.map(l=>[l.id,l]));function X(l){return V.get(l)}function Y(l){return l.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-|-$/g,"")}function Z(l){const o=l.map(u=>{const g=u.items.map(c=>`      { itemId: "${c.itemId}", qtyOwned: 0, qtyRequired: ${c.qtyRequired}, isCompleted: false }`).join(`,
`);return`  {
    id: "${u.id}",
    name: "${u.name}",
    isSystem: true,
    items: [
${g},
    ],
  }`}).join(`,
`);return`import type { Keeplist } from "../types";

// System keeplists - default state provided by the app
// Generated by Keeplist Builder on ${new Date().toISOString()}
export const systemKeeplists: Keeplist[] = [
${o},
];
`}function ee(){const[l,o]=n.useState(()=>JSON.parse(JSON.stringify(I))),[u,g]=n.useState(new Set(I.map(e=>e.id))),[c,x]=n.useState(""),[E,p]=n.useState(null),[h,C]=n.useState(""),[b,_]=n.useState(null),[y,w]=n.useState(0),[m,f]=n.useState(null),j=n.useRef(null),D=n.useRef(new Map),A=n.useRef(null),O=!1,N=n.useMemo(()=>{if(!c.trim())return S.slice(0,20);const e=c.toLowerCase();return S.filter(t=>t.name.toLowerCase().includes(e)).slice(0,20)},[c]);n.useEffect(()=>{w(0)},[c]);const R=e=>{const t=l.find(r=>r.id===e);return t?N.filter(r=>!t.items.some(s=>s.itemId===r.id)):N},U=(e,t)=>{const r=R(t);switch(e.key){case"ArrowDown":e.preventDefault(),w(s=>s<r.length-1?s+1:s);break;case"ArrowUp":e.preventDefault(),w(s=>s>0?s-1:0);break;case"Enter":e.preventDefault(),r[y]&&$(t,r[y].id);break;case"Escape":e.preventDefault(),p(null),x("");break}};n.useEffect(()=>{if(j.current){const e=j.current.querySelector('[data-highlighted="true"]');e&&e.scrollIntoView({block:"nearest"})}},[y]),n.useEffect(()=>{if(m){const e=`${m.keeplistId}-${m.itemId}`,t=D.current.get(e);t&&(t.focus(),t.select())}},[m]);const T=(e,t,r,s)=>{switch(e.key){case"ArrowUp":e.preventDefault(),v(t,r,s+1);break;case"ArrowDown":e.preventDefault(),v(t,r,s-1);break;case"Enter":e.preventDefault(),f(null),p(t),x(""),w(0);break;case"Escape":e.preventDefault(),f(null),e.target.blur();break}},B=e=>{g(t=>{const r=new Set(t);return r.has(e)?r.delete(e):r.add(e),r})},K=()=>{if(!h.trim())return;const e=Y(h);if(l.some(t=>t.id===e)){alert("A keeplist with this name already exists");return}o(t=>[...t,{id:e,name:h.trim(),isSystem:!0,items:[]}]),g(t=>new Set([...t,e])),C("")},F=e=>{confirm("Remove this keeplist?")&&o(t=>t.filter(r=>r.id!==e))},$=(e,t)=>{o(r=>r.map(s=>s.id!==e||s.items.some(i=>i.itemId===t)?s:{...s,items:[...s.items,{itemId:t,qtyOwned:0,qtyRequired:1,isCompleted:!1}]})),p(null),x(""),setTimeout(()=>{f({keeplistId:e,itemId:t})},0)},M=(e,t)=>{o(r=>r.map(s=>s.id!==e?s:{...s,items:s.items.filter(i=>i.itemId!==t)}))},v=(e,t,r)=>{o(s=>s.map(i=>i.id!==e?i:{...i,items:i.items.map(d=>d.itemId===t?{...d,qtyRequired:Math.max(1,r)}:d)}))},J=()=>{const e=Z(l),t=new Blob([e],{type:"text/typescript"}),r=URL.createObjectURL(t),s=document.createElement("a");s.href=r,s.download="systemKeeplists.ts",s.click(),URL.revokeObjectURL(r)},Q=()=>{confirm("Reset to the current systemKeeplists.ts? Unsaved changes will be lost.")&&o(JSON.parse(JSON.stringify(I)))};return a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex gap-2",children:[a.jsx("input",{type:"text",value:h,onChange:e=>C(e.target.value),onKeyDown:e=>e.key==="Enter"&&K(),placeholder:"New keeplist name...",className:"flex-1 px-3 py-2 bg-slate-800 border border-slate-700 rounded-lg text-slate-100 placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500"}),a.jsxs("button",{onClick:K,disabled:!h.trim(),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-500 disabled:bg-slate-700 disabled:text-slate-500 rounded-lg transition-colors",children:[a.jsx(L,{className:"w-4 h-4"}),"Add List"]})]}),a.jsx("div",{className:"space-y-3",children:l.map(e=>a.jsxs("div",{className:"bg-slate-800 rounded-lg border border-slate-700 overflow-hidden",children:[a.jsxs("div",{className:"flex items-center gap-2 px-4 py-3 bg-slate-800/80",children:[a.jsx("button",{onClick:()=>B(e.id),className:"text-slate-400 hover:text-slate-200",children:u.has(e.id)?a.jsx(H,{className:"w-5 h-5"}):a.jsx(P,{className:"w-5 h-5"})}),a.jsx("span",{className:"flex-1 font-medium",children:e.name}),a.jsxs("span",{className:"text-sm text-slate-500",children:[e.items.length," items"]}),a.jsx("button",{onClick:()=>F(e.id),className:"p-1 text-slate-500 hover:text-red-400 transition-colors",title:"Remove keeplist",children:a.jsx(q,{className:"w-4 h-4"})})]}),u.has(e.id)&&a.jsxs("div",{className:"px-4 pb-3 space-y-2",children:[e.items.map(t=>{const r=X(t.itemId)||{id:t.itemId,name:t.itemId.split("-").map(s=>s.charAt(0).toUpperCase()+s.slice(1)).join(" "),rarity:"Common"};return a.jsxs("div",{className:"flex items-center gap-3 py-2 px-3 bg-slate-900/50 rounded-lg",children:[a.jsx("span",{className:"flex-1 text-sm",children:r.name}),a.jsx("span",{className:`text-xs px-2 py-0.5 rounded rarity-${r.rarity.toLowerCase()}`,children:r.rarity}),a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx("span",{className:"text-xs text-slate-500",children:"Qty:"}),a.jsx("input",{ref:s=>{s&&D.current.set(`${e.id}-${t.itemId}`,s)},type:"number",min:"1",value:t.qtyRequired,onChange:s=>v(e.id,t.itemId,parseInt(s.target.value)||1),onKeyDown:s=>T(s,e.id,t.itemId,t.qtyRequired),onFocus:()=>f({keeplistId:e.id,itemId:t.itemId}),onBlur:()=>{f(s=>s?.keeplistId===e.id&&s?.itemId===t.itemId?null:s)},className:`w-16 px-2 py-1 bg-slate-800 border rounded text-sm text-center transition-colors ${m?.keeplistId===e.id&&m?.itemId===t.itemId?"border-blue-500 ring-1 ring-blue-500":"border-slate-700"}`})]}),a.jsx("button",{onClick:()=>M(e.id,t.itemId),className:"p-1 text-slate-500 hover:text-red-400 transition-colors",children:a.jsx(q,{className:"w-4 h-4"})})]},t.itemId)}),E===e.id?a.jsxs("div",{className:"mt-2 p-3 bg-slate-900 rounded-lg border border-slate-600",children:[a.jsxs("div",{className:"relative mb-2",children:[a.jsx(z,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-500"}),a.jsx("input",{ref:A,type:"text",value:c,onChange:t=>x(t.target.value),onKeyDown:t=>U(t,e.id),placeholder:"Search... (↑↓ navigate, Enter select, Esc cancel)",autoFocus:!0,className:"w-full pl-9 pr-3 py-2 bg-slate-800 border border-slate-700 rounded text-sm text-slate-100 placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),a.jsx("div",{ref:j,className:"max-h-48 overflow-y-auto space-y-1",children:(()=>{let t=0;return N.map(r=>{const s=e.items.some(W=>W.itemId===r.id),i=s?-1:t++,d=!s&&i===y;return a.jsxs("button",{onClick:()=>$(e.id,r.id),disabled:s,"data-highlighted":d,className:`w-full flex items-center gap-2 px-3 py-2 text-left text-sm rounded transition-colors ${d?"bg-blue-600 text-white":"hover:bg-slate-800"} ${s?"opacity-50 cursor-not-allowed":""}`,children:[a.jsx("span",{className:"flex-1",children:r.name}),a.jsx("span",{className:`text-xs ${d?"text-blue-200":`rarity-${r.rarity.toLowerCase()}`}`,children:r.rarity})]},r.id)})})()}),a.jsxs("div",{className:"flex items-center justify-between mt-2",children:[a.jsx("button",{onClick:()=>{p(null),x("")},className:"text-xs text-slate-500 hover:text-slate-300",children:"Cancel (Esc)"}),a.jsxs("span",{className:"text-xs text-slate-600",children:[R(e.id).length," available"]})]})]}):a.jsxs("button",{onClick:()=>p(e.id),className:"w-full flex items-center justify-center gap-2 py-2 text-sm text-slate-500 hover:text-slate-300 hover:bg-slate-900/50 rounded-lg transition-colors",children:[a.jsx(L,{className:"w-4 h-4"}),"Add Item"]})]})]},e.id))}),a.jsxs("div",{className:"flex flex-wrap gap-3 pt-4 border-t border-slate-700",children:[a.jsxs("button",{onClick:J,className:"flex items-center gap-2 px-4 py-2 bg-slate-700 hover:bg-slate-600 rounded-lg transition-colors",children:[a.jsx(G,{className:"w-4 h-4"}),"Download systemKeeplists.ts"]}),O,a.jsx("button",{onClick:Q,className:"flex items-center gap-2 px-4 py-2 bg-slate-800 hover:bg-slate-700 text-slate-400 rounded-lg transition-colors",children:"Reset to Current"}),b&&a.jsx("span",{className:`flex items-center text-sm ${b.startsWith("Error")?"text-red-400":b==="Writing..."?"text-yellow-400":"text-green-400"}`,children:b})]}),a.jsx("p",{className:"text-xs text-slate-500",children:"Download the file and replace src/data/systemKeeplists.ts manually, then rebuild."})]})}export{ee as KeeplistBuilder};
