import{r as n,s as C,u as G,a as O,j as a,P as A,C as V,b as X,T,g as Y,S as Z,D as _,c as k}from"./index-DQFXzU5D.js";function ee(i){return i.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-|-$/g,"")}function te(i){const o=i.map(m=>{const g=m.items.map(c=>`      { itemId: "${c.itemId}", qtyOwned: 0, qtyRequired: ${c.qtyRequired}, isCompleted: false }`).join(`,
`);return`  {
    id: "${m.id}",
    name: "${m.name}",
    isSystem: true,
    items: [
${g},
    ],
  }`}).join(`,
`);return`import type { Keeplist } from "../types";

// System keeplists - default state provided by the app
// Generated by Keeplist Builder on ${new Date().toISOString()}
export const systemKeeplists: Keeplist[] = [
${o},
];
`}function re(){const[i,o]=n.useState(()=>JSON.parse(JSON.stringify(C))),[m,g]=n.useState(new Set(C.map(e=>e.id))),[c,x]=n.useState(""),[U,p]=n.useState(null),[h,D]=n.useState(""),[b,se]=n.useState(null),[y,w]=n.useState(0),[u,f]=n.useState(null),[j,N]=n.useState(null),v=n.useRef(null),R=n.useRef(new Map),{confirm:$,dialogProps:K}=G(),F=!1,I=n.useMemo(()=>{if(!c.trim())return O.slice(0,20);const e=c.toLowerCase();return O.filter(t=>t.name.toLowerCase().includes(e)).slice(0,20)},[c]);n.useEffect(()=>{w(0)},[c]);const L=e=>{const t=i.find(r=>r.id===e);return t?I.filter(r=>!t.items.some(s=>s.itemId===r.id)):I},B=(e,t)=>{const r=L(t);switch(e.key){case"ArrowDown":e.preventDefault(),w(s=>s<r.length-1?s+1:s);break;case"ArrowUp":e.preventDefault(),w(s=>s>0?s-1:0);break;case"Enter":e.preventDefault(),r[y]&&q(t,r[y].id);break;case"Escape":e.preventDefault(),p(null),x("");break}};n.useEffect(()=>{if(v.current){const e=v.current.querySelector('[data-highlighted="true"]');e&&e.scrollIntoView({block:"nearest"})}},[y]),n.useEffect(()=>{if(u){const e=`${u.keeplistId}-${u.itemId}`,t=R.current.get(e);t&&(t.focus(),t.select())}},[u]);const J=(e,t,r,s)=>{switch(e.key){case"ArrowUp":e.preventDefault(),S(t,r,s+1);break;case"ArrowDown":e.preventDefault(),S(t,r,s-1);break;case"Enter":e.preventDefault(),f(null),p(t),x(""),w(0);break;case"Escape":e.preventDefault(),f(null),e.target.blur();break}},Q=e=>{g(t=>{const r=new Set(t);return r.has(e)?r.delete(e):r.add(e),r})},E=()=>{if(!h.trim())return;const e=ee(h);if(i.some(t=>t.id===e)){N("A keeplist with this name already exists");return}o(t=>[...t,{id:e,name:h.trim(),isSystem:!0,items:[]}]),g(t=>new Set([...t,e])),D(""),N(null)},W=async(e,t)=>{await $({title:"Remove Keeplist",message:`Remove "${t}" from the system keeplists?`,confirmLabel:"Remove",variant:"danger"})&&o(s=>s.filter(l=>l.id!==e))},q=(e,t)=>{o(r=>r.map(s=>s.id!==e||s.items.some(l=>l.itemId===t)?s:{...s,items:[...s.items,{itemId:t,qtyOwned:0,qtyRequired:1,isCompleted:!1}]})),p(null),x(""),setTimeout(()=>{f({keeplistId:e,itemId:t})},0)},M=(e,t)=>{o(r=>r.map(s=>s.id!==e?s:{...s,items:s.items.filter(l=>l.itemId!==t)}))},S=(e,t,r)=>{o(s=>s.map(l=>l.id!==e?l:{...l,items:l.items.map(d=>d.itemId===t?{...d,qtyRequired:Math.max(1,r)}:d)}))},P=()=>{const e=te(i),t=new Blob([e],{type:"text/typescript"}),r=URL.createObjectURL(t),s=document.createElement("a");s.href=r,s.download="systemKeeplists.ts",s.click(),URL.revokeObjectURL(r)},H=async()=>{await $({title:"Reset to Default",message:"Reset to the current systemKeeplists.ts? Unsaved changes will be lost.",confirmLabel:"Reset",variant:"warning"})&&o(JSON.parse(JSON.stringify(C)))};return a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"flex gap-2",children:[a.jsx("input",{type:"text",value:h,onChange:e=>{D(e.target.value),N(null)},onKeyDown:e=>e.key==="Enter"&&E(),placeholder:"New keeplist name...",className:`flex-1 px-3 py-2 bg-slate-800 border rounded-lg text-slate-100 placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500 ${j?"border-red-500":"border-slate-700"}`}),a.jsxs("button",{onClick:E,disabled:!h.trim(),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-500 disabled:bg-slate-700 disabled:text-slate-500 rounded-lg transition-colors",children:[a.jsx(A,{className:"w-4 h-4"}),"Add List"]})]}),j&&a.jsx("p",{className:"text-sm text-red-400",children:j})]}),a.jsx("div",{className:"space-y-3",children:i.map(e=>a.jsxs("div",{className:"bg-slate-800 rounded-lg border border-slate-700 overflow-hidden",children:[a.jsxs("div",{className:"flex items-center gap-2 px-4 py-3 bg-slate-800/80",children:[a.jsx("button",{onClick:()=>Q(e.id),className:"text-slate-400 hover:text-slate-200",children:m.has(e.id)?a.jsx(V,{className:"w-5 h-5"}):a.jsx(X,{className:"w-5 h-5"})}),a.jsx("span",{className:"flex-1 font-medium",children:e.name}),a.jsxs("span",{className:"text-sm text-slate-500",children:[e.items.length," items"]}),a.jsx("button",{onClick:()=>W(e.id,e.name),className:"p-1 text-slate-500 hover:text-red-400 transition-colors",title:"Remove keeplist",children:a.jsx(T,{className:"w-4 h-4"})})]}),m.has(e.id)&&a.jsxs("div",{className:"px-4 pb-3 space-y-2",children:[e.items.map(t=>{const r=Y(t.itemId);return a.jsxs("div",{className:"flex items-center gap-3 py-2 px-3 bg-slate-900/50 rounded-lg",children:[a.jsx("span",{className:"flex-1 text-sm",children:r.name}),a.jsx("span",{className:`text-xs px-2 py-0.5 rounded rarity-${r.rarity.toLowerCase()}`,children:r.rarity}),a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx("span",{className:"text-xs text-slate-500",children:"Qty:"}),a.jsx("input",{ref:s=>{s&&R.current.set(`${e.id}-${t.itemId}`,s)},type:"number",min:"1",value:t.qtyRequired,onChange:s=>S(e.id,t.itemId,parseInt(s.target.value)||1),onKeyDown:s=>J(s,e.id,t.itemId,t.qtyRequired),onFocus:()=>f({keeplistId:e.id,itemId:t.itemId}),onBlur:()=>{f(s=>s?.keeplistId===e.id&&s?.itemId===t.itemId?null:s)},className:`w-16 px-2 py-1 bg-slate-800 border rounded text-sm text-center transition-colors ${u?.keeplistId===e.id&&u?.itemId===t.itemId?"border-blue-500 ring-1 ring-blue-500":"border-slate-700"}`})]}),a.jsx("button",{onClick:()=>M(e.id,t.itemId),className:"p-1 text-slate-500 hover:text-red-400 transition-colors",children:a.jsx(T,{className:"w-4 h-4"})})]},t.itemId)}),U===e.id?a.jsxs("div",{className:"mt-2 p-3 bg-slate-900 rounded-lg border border-slate-600",children:[a.jsxs("div",{className:"relative mb-2",children:[a.jsx(Z,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-500"}),a.jsx("input",{type:"text",value:c,onChange:t=>x(t.target.value),onKeyDown:t=>B(t,e.id),placeholder:"Search... (↑↓ navigate, Enter select, Esc cancel)",autoFocus:!0,className:"w-full pl-9 pr-3 py-2 bg-slate-800 border border-slate-700 rounded text-sm text-slate-100 placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),a.jsx("div",{ref:v,className:"max-h-48 overflow-y-auto space-y-1",children:(()=>{let t=0;return I.map(r=>{const s=e.items.some(z=>z.itemId===r.id),l=s?-1:t++,d=!s&&l===y;return a.jsxs("button",{onClick:()=>q(e.id,r.id),disabled:s,"data-highlighted":d,className:`w-full flex items-center gap-2 px-3 py-2 text-left text-sm rounded transition-colors ${d?"bg-blue-600 text-white":"hover:bg-slate-800"} ${s?"opacity-50 cursor-not-allowed":""}`,children:[a.jsx("span",{className:"flex-1",children:r.name}),a.jsx("span",{className:`text-xs ${d?"text-blue-200":`rarity-${r.rarity.toLowerCase()}`}`,children:r.rarity})]},r.id)})})()}),a.jsxs("div",{className:"flex items-center justify-between mt-2",children:[a.jsx("button",{onClick:()=>{p(null),x("")},className:"text-xs text-slate-500 hover:text-slate-300",children:"Cancel (Esc)"}),a.jsxs("span",{className:"text-xs text-slate-600",children:[L(e.id).length," available"]})]})]}):a.jsxs("button",{onClick:()=>p(e.id),className:"w-full flex items-center justify-center gap-2 py-2 text-sm text-slate-500 hover:text-slate-300 hover:bg-slate-900/50 rounded-lg transition-colors",children:[a.jsx(A,{className:"w-4 h-4"}),"Add Item"]})]})]},e.id))}),a.jsxs("div",{className:"flex flex-wrap gap-3 pt-4 border-t border-slate-700",children:[a.jsxs("button",{onClick:P,className:"flex items-center gap-2 px-4 py-2 bg-slate-700 hover:bg-slate-600 rounded-lg transition-colors",children:[a.jsx(_,{className:"w-4 h-4"}),"Download systemKeeplists.ts"]}),F,a.jsx("button",{onClick:H,className:"flex items-center gap-2 px-4 py-2 bg-slate-800 hover:bg-slate-700 text-slate-400 rounded-lg transition-colors",children:"Reset to Current"}),b&&a.jsx("span",{className:`flex items-center text-sm ${b.startsWith("Error")?"text-red-400":b==="Writing..."?"text-yellow-400":"text-green-400"}`,children:b})]}),a.jsx("p",{className:"text-xs text-slate-500",children:"Download the file and replace src/data/systemKeeplists.ts manually, then rebuild."}),K&&a.jsx(k,{...K})]})}export{re as KeeplistBuilder};
